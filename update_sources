#!/bin/sh
set -e

. ./config.subr

echo "$PWD/update_sources"

echo "# sources.mk generated by update_sources" > ${SOURCES_MK}
echo "# sources.sh generated by update_sources" > ${SOURCES_SH}

KC3_CONFIGURES="$(find ekc3 ikc3 kc3c kc3s libkc3 libkc3_window libtommath test ucd2c -name configure -or -name update_sources -or -name sources.sh)"
sources KC3_CONFIGURES "$KC3_CONFIGURES"

KC3_MAKEFILES="$(find ekc3 ikc3 kc3c kc3s libkc3 libkc3_window libtommath test ucd2c -name Makefile -or -name gen.mk -or -name sources.mk)"
KC3_MAKEFILES="$(echo "$KC3_MAKEFILES" | grep -v 'libtommath/logs/Makefile')"
sources KC3_MAKEFILES "$KC3_MAKEFILES"

KC3_C_SOURCES="$(find ekc3 ikc3 kc3c kc3s libkc3 libkc3_window test -name "[a-z]*.c" -or -name "[a-z]*.h" -or -name "[a-z]*.c.in" -or -name "[a-z]*.h.in")"
KC3_C_SOURCES="$(echo "${KC3_C_SOURCES}" | grep -Ev '/config[.]h$')"
KC3_C_SOURCES="$KC3_C_SOURCES
ucd2c/ucd.h
ucd2c/ucd2c.c"
sources KC3_C_SOURCES "$KC3_C_SOURCES"

KC3_OBJC_SOURCES="$(find libkc3_window -name "[a-z]*.m" -or -name "[a-z]*.m.in")"
sources KC3_OBJC_SOURCES "$KC3_OBJC_SOURCES"

KC3_OTHER_SOURCES="AUTHORS
Makefile
README.md
kc3.index
kc3.version
config.subr
configure
license.h
sources.mk
sources.sh
$(find img -name '*.png' -or -name '*.jpg' -or -name '*.jpeg' -or -name '*.xcf')
$(find lib -name '*.facts' -or -name '*.kc3')
$(find libkc3 test -name '*.rb')
$(find fonts -name '*.otf' -or -name '*.ttf')
$(find test -name '*.expected' -or -name '*.facts' -or -name '*.in' -or -name '*.lisp')
test/ikc3_test
test/zero"
sources KC3_OTHER_SOURCES "$KC3_OTHER_SOURCES"

KC3_EXTERNAL_SOURCES="$(find libtommath linenoise -name '*.[ch]')
libtommath/LICENSE
libtommath/README.md
linenoise/LICENSE
linenoise/README.markdown
ucd2c/UCD.zip
$(find ucd2c/UCD -type f)"
sources KC3_EXTERNAL_SOURCES "$KC3_EXTERNAL_SOURCES"

update_sources_mk
update_sources_sh

( cd libtommath && ./update_sources; )
( cd libkc3 && ./update_sources; )
( cd ikc3 && ./update_sources; )
( cd kc3s && ./update_sources; )
( cd ekc3 && ./update_sources; )
( cd test && ./update_sources; )
( cd libkc3_window && ./update_sources; )
