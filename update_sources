#!/bin/sh
set -e

. ./config.subr

echo "# sources.mk generated by update_sources" > ${SOURCES_MK}
echo "# sources.sh generated by update_sources" > ${SOURCES_SH}

C3_CONFIGURES="$(find c3c c3s ic3 libc3 libtommath test ucd2c -name configure -or -name update_sources -or -name sources.sh)"
sources C3_CONFIGURES "$C3_CONFIGURES"

C3_MAKEFILES="$(find c3c c3s ic3 libc3 libtommath test ucd2c -name Makefile -or -name gen.mk -or -name sources.mk)"
C3_MAKEFILES="$(echo "$C3_MAKEFILES" | grep -v 'libtommath/logs/Makefile')"
sources C3_MAKEFILES "$C3_MAKEFILES"

C3_C_SOURCES="$(find c3c c3s ic3 libc3 test -name "[a-z]*.c" -or -name "[a-z]*.h" -or -name "[a-z]*.c.in" -or -name "[a-z]*.h.in")"
C3_C_SOURCES="$(echo "${C3_C_SOURCES}" | grep -Ev '^libc3/config[.]h$')"
C3_C_SOURCES="$C3_C_SOURCES
ucd2c/ucd.h
ucd2c/ucd2c.c"
sources C3_C_SOURCES "$C3_C_SOURCES"

C3_OBJC_SOURCES="$(find libc3 -name "[a-z]*.m" -or -name "[a-z]*.m.in")"
sources C3_OBJC_SOURCES "$C3_OBJC_SOURCES"

C3_OTHER_SOURCES="AUTHORS
Makefile
README.md
c3.index
c3.version
config.subr
configure
license.h
sources.mk
sources.sh
$(find img -name '*.png' -or -name '*.jpg' -or -name '*.jpeg' -or -name '*.xcf')
$(find lib -name '*.facts')
$(find libc3 test -name '*.rb')
$(find fonts -name '*.otf' -or -name '*.ttf')
$(find test -name '*.expected' -or -name '*.facts' -or -name '*.in' -or -name '*.lisp')
test/ic3_test
test/zero"
sources C3_OTHER_SOURCES "$C3_OTHER_SOURCES"

C3_EXTERNAL_SOURCES="$(find linenoise ucd2c \( -name '.*' -prune \) -or -type f -print)
$(find libtommath -name '*.c' -or -name '*.h')
libtommath/LICENSE
libtommath/README.md"
sources C3_EXTERNAL_SOURCES "$C3_EXTERNAL_SOURCES"

update_sources_mk
update_sources_sh

( cd libtommath && ./update_sources; )
( cd libc3 && ./update_sources; )
( cd libc3_window && ./update_sources; )
( cd ic3 && ./update_sources; )
( cd c3s && ./update_sources; )
( cd test && ./update_sources; )
